import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
// src/components/admin/AdminReceipts.tsx
import { useState } from 'react';
import { useGetAllReceiptsQuery } from '../../features/api/paymentApi';
import { Receipt, Search, Filter, Download, Eye, User, Calendar, CreditCard } from 'lucide-react';
import { format } from 'date-fns';
import { useNavigate } from 'react-router-dom';
const AdminReceipts = () => {
    const { data: receiptsResponse, isLoading, error } = useGetAllReceiptsQuery();
    const [searchTerm, setSearchTerm] = useState('');
    const [filterMethod, setFilterMethod] = useState('all');
    const navigate = useNavigate();
    if (isLoading) {
        return (_jsx("div", { className: "flex justify-center py-8", children: _jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-[#027480]" }) }));
    }
    if (error) {
        return (_jsx("div", { className: "bg-red-900/20 border border-red-800/30 rounded-lg p-4 text-center", children: _jsx("p", { className: "text-red-300", children: "Failed to load receipts" }) }));
    }
    const receipts = receiptsResponse?.data || [];
    // Filter receipts
    const filteredReceipts = receipts.filter(receipt => {
        const matchesSearch = receipt.transaction_id.toLowerCase().includes(searchTerm.toLowerCase()) ||
            `${receipt.first_name} ${receipt.last_name}`.toLowerCase().includes(searchTerm.toLowerCase()) ||
            receipt.vehicle_make.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesMethod = filterMethod === 'all' || receipt.payment_method === filterMethod;
        return matchesSearch && matchesMethod;
    });
    // Calculate statistics
    const totalRevenue = receipts.reduce((sum, receipt) => sum + receipt.amount, 0);
    const mpesaCount = receipts.filter(r => r.payment_method === 'M-Pesa').length;
    const cardCount = receipts.filter(r => r.payment_method === 'Card').length;
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex justify-between items-center", children: [_jsx("h2", { className: "text-2xl font-bold text-white", children: "Payment Receipts" }), _jsxs("div", { className: "text-sm text-gray-400", children: ["Total: ", receipts.length, " receipts \u2022 Revenue: KES ", totalRevenue.toLocaleString()] })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [_jsx("div", { className: "bg-[#001524] border border-[#445048] rounded-xl p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-400", children: "Total Revenue" }), _jsxs("p", { className: "text-2xl font-bold text-white", children: ["KES ", totalRevenue.toLocaleString()] })] }), _jsx(Receipt, { className: "h-10 w-10 text-green-500" })] }) }), _jsx("div", { className: "bg-[#001524] border border-[#445048] rounded-xl p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-400", children: "M-Pesa Payments" }), _jsx("p", { className: "text-2xl font-bold text-white", children: mpesaCount })] }), _jsx("div", { className: "h-10 w-10 bg-green-900/30 rounded-full flex items-center justify-center", children: _jsx("span", { className: "text-green-400", children: "M" }) })] }) }), _jsx("div", { className: "bg-[#001524] border border-[#445048] rounded-xl p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-gray-400", children: "Card Payments" }), _jsx("p", { className: "text-2xl font-bold text-white", children: cardCount })] }), _jsx(CreditCard, { className: "h-10 w-10 text-blue-500" })] }) })] }), _jsxs("div", { className: "flex flex-col md:flex-row gap-4", children: [_jsxs("div", { className: "flex-1 relative", children: [_jsx(Search, { className: "absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" }), _jsx("input", { type: "text", placeholder: "Search by transaction ID, customer, or vehicle...", value: searchTerm, onChange: (e) => setSearchTerm(e.target.value), className: "w-full bg-[#0f2434] border border-[#445048] rounded-lg pl-10 pr-4 py-2 text-white focus:outline-none focus:border-[#027480] focus:ring-2 focus:ring-[#027480]/50" })] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(Filter, { className: "h-5 w-5 text-gray-400" }), _jsxs("select", { value: filterMethod, onChange: (e) => setFilterMethod(e.target.value), className: "bg-[#0f2434] border border-[#445048] rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#027480]", children: [_jsx("option", { value: "all", children: "All Methods" }), _jsx("option", { value: "M-Pesa", children: "M-Pesa" }), _jsx("option", { value: "Card", children: "Card" })] })] })] }), _jsxs("div", { className: "bg-[#001524] border border-[#445048] rounded-xl overflow-hidden", children: [_jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "w-full", children: [_jsx("thead", { className: "bg-[#0f2434]", children: _jsxs("tr", { children: [_jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Transaction" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Customer" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Vehicle" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Method" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Amount" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Date" }), _jsx("th", { className: "py-3 px-4 text-left text-sm font-medium text-gray-300", children: "Actions" })] }) }), _jsx("tbody", { className: "divide-y divide-[#445048]", children: filteredReceipts.map((receipt) => (_jsxs("tr", { className: "hover:bg-[#0f2434]/50", children: [_jsxs("td", { className: "py-3 px-4", children: [_jsx("div", { className: "font-mono text-sm text-gray-300", children: receipt.transaction_id }), _jsxs("div", { className: "text-xs text-gray-500", children: ["#", receipt.payment_id] })] }), _jsx("td", { className: "py-3 px-4", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(User, { className: "h-4 w-4 text-gray-400" }), _jsxs("div", { children: [_jsxs("div", { className: "text-sm font-medium text-white", children: [receipt.first_name, " ", receipt.last_name] }), _jsxs("div", { className: "text-xs text-gray-500", children: ["B#", receipt.booking_id] })] })] }) }), _jsx("td", { className: "py-3 px-4", children: _jsxs("div", { className: "text-sm text-white", children: [receipt.vehicle_make, " ", receipt.vehicle_model] }) }), _jsx("td", { className: "py-3 px-4", children: _jsx("span", { className: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${receipt.payment_method === 'M-Pesa'
                                                        ? 'bg-green-900/30 text-green-300'
                                                        : 'bg-blue-900/30 text-blue-300'}`, children: receipt.payment_method }) }), _jsx("td", { className: "py-3 px-4", children: _jsxs("div", { className: "text-lg font-bold text-white", children: ["KES ", receipt.amount.toLocaleString()] }) }), _jsx("td", { className: "py-3 px-4", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(Calendar, { className: "h-4 w-4 text-gray-400" }), _jsx("span", { className: "text-sm text-gray-300", children: format(new Date(receipt.payment_date), 'MMM dd, yyyy') })] }) }), _jsx("td", { className: "py-3 px-4", children: _jsxs("div", { className: "flex gap-2", children: [_jsx("button", { onClick: () => navigate(`/receipt/${receipt.payment_id}`), className: "p-2 bg-[#027480] hover:bg-[#02606d] rounded-lg transition-colors", title: "View Receipt", children: _jsx(Eye, { className: "h-4 w-4 text-white" }) }), _jsx("button", { onClick: () => window.open(`/api/payments/${receipt.payment_id}/receipt?download=true`, '_blank'), className: "p-2 border border-[#445048] text-gray-400 hover:text-white hover:border-gray-500 rounded-lg transition-colors", title: "Download PDF", children: _jsx(Download, { className: "h-4 w-4" }) })] }) })] }, receipt.payment_id))) })] }) }), filteredReceipts.length === 0 && (_jsxs("div", { className: "text-center py-12", children: [_jsx(Receipt, { className: "h-12 w-12 text-gray-400 mx-auto mb-3" }), _jsx("p", { className: "text-gray-400", children: "No receipts found matching your criteria" })] }))] })] }));
};
export default AdminReceipts;
